{% extends 'base.html' %}
{% load static %}
{% block content %}

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css"
    integrity="sha512-SnH5WK+bZxgPHs44uWIX+LLJAJ9/2PkPKZ5QiAj6Ta86w+fsb2TkcmfRyVX3pBnMFcV7oQPJkl9QevSCWr3W6A=="
    crossorigin="anonymous" referrerpolicy="no-referrer" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/css/bootstrap.min.css">

<style>
    .container {
        max-width: 750px;
        margin: 40px auto;
        padding: 25px;
        background-color: #fff;
        border-radius: 10px;
        box-shadow: 0 2px 15px rgba(0, 0, 0, 0.1);
    }

    .title {
        text-align: center;
        font-size: 2rem;
        color: #333;
        margin-bottom: 20px;
    }

    ul {
        padding-left: 0;
        margin-bottom: 20px;
    }

    li {
        list-style: none;
    }

    .folder-item,
    .file-item {
        display: flex;
        align-items: center;
        justify-content: space-between;
        background-color: #f9f9f9;
        padding: 15px;
        border-radius: 8px;
        margin-bottom: 10px;
        transition: box-shadow 0.3s ease;
    }

    .folder-item:hover,
    .file-item:hover {
        box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
    }

    .folder-link,
    .file-link {
        text-decoration: none;
        font-size: 1rem;
        color: #007bff;
        display: inline-flex;
        align-items: center;
    }

    .folder-link i,
    .file-link i {
        margin-right: 8px;
    }

    .btn {
        display: inline-block;
        padding: 10px 20px;
        background-color: #007bff;
        color: #fff;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        font-size: 1rem;
        transition: background-color 0.3s ease;
    }

    .btn:hover {
        background-color: #0056b3;
    }

    .btn-back {
        background-color: #6c757d;
    }

    .btn-back:hover {
        background-color: #5a6268;
    }

    .btn-download {
        margin-left: 10px;
        padding: 6px 12px;
    }

    .section-title {
        margin-top: 20px;
        margin-bottom: 10px;
        font-size: 1.5rem;
        color: #333;
    }

    .invite-user-form {
        margin-top: 40px;
    }
</style>

<div class="container">
    <!-- Go Back Button -->
    <button class="btn btn-back" onclick="goBack()"><i class="fas fa-arrow-left"></i> Back</button>

    <h1 class="title">{{ folder.name }}</h1>

    <!-- Add Folder Button -->
    <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addFolderModal">
        <i class="fas fa-plus"></i> Add Folder
    </button>

    <!-- Upload File Button -->
    <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#uploadFileModal">
        <i class="fas fa-upload"></i> Upload File
    </button>

    <!-- Folders List -->
    <div class="folders-container mt-5">
        <h2 class="section-title">Folders</h2>
        <ul class="folders-list">
            {% for subfolder in subfolders %}
            <li class="folder-item">
                <a href="{% url 'home:folder_detail' folder_id=subfolder.pk %}" class="folder-link">
                    <i class="fas fa-folder"></i> {{ subfolder.name }}
                </a>

                <!-- Share Folder Button -->
                <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#shareFolderModal"
                    data-folder-id="{{ subfolder.pk }}">
                    <i class="fas fa-share-alt"></i> Share
                </button>

                <form method="post" action="{% url 'home:delete_folder' folder_id=subfolder.pk %}"
                    style="display:inline;">
                    {% csrf_token %}
                    <button type="submit" class="btn btn-delete"><i class="fas fa-trash"></i> Delete</button>
                </form>
            </li>
            {% empty %}
            <li class="no-folders">No subfolders available.</li>
            {% endfor %}
        </ul>
    </div>

    <!-- Files List -->
    <div class="files-container">
        <h2 class="section-title">Files</h2>
        <ul class="files-list">
            {% for file in files %}
            <li class="file-item">
                <a href="{{ file.file.url }}" class="file-link">
                    <i class="fas fa-file"></i> {{ file.name }}
                </a>
                <a href="{{ file.file.url }}" class="btn btn-download" download>
                    <i class="fas fa-download"></i> Download
                </a>
                <form method="post" action="{% url 'home:delete_file' file_id=file.pk %}" style="display:inline;">
                    {% csrf_token %}
                    <button type="submit" class="btn btn-delete"><i class="fas fa-trash"></i> Delete</button>
                </form>
                <!-- Share Button -->
                <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#shareFileModal{{ file.pk }}">
                    <i class="fas fa-user-plus"></i> Share
                </button>

                <!-- Share File Modal -->
                <div class="modal fade" id="shareFileModal{{ file.pk }}" tabindex="-1"
                    aria-labelledby="shareFileModalLabel{{ file.pk }}" aria-hidden="true">
                    <div class="modal-dialog">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title" id="shareFileModalLabel{{ file.pk }}">Share File</h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal"
                                    aria-label="Close"></button>
                            </div>
                            <div class="modal-body">
                                <form method="post" action="{% url 'home:share_file' file_id=file.pk %}">
                                    {% csrf_token %}
                                    <div class="form-group">
                                        <input type="text" name="username" class="form-control"
                                            placeholder="Enter username" required>
                                    </div>
                                    <button type="submit" class="btn btn-primary mt-3"><i class="fas fa-user-plus"></i>
                                        Share File</button>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            </li>
            {% empty %}
            <li class="no-files">No files available.</li>
            {% endfor %}
        </ul>
    </div>
</div>

<!-- Add Folder Modal -->
<div class="modal fade" id="addFolderModal" tabindex="-1" aria-labelledby="addFolderModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="addFolderModalLabel">Create New Folder</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form method="post" action="">
                    {% csrf_token %}
                    {{ form.as_p }}
                    <button type="submit" class="btn btn-primary"><i class="fas fa-plus"></i> Create Folder</button>
                </form>
            </div>
        </div>
    </div>
</div>

<!-- Upload File Modal -->
<div class="modal fade" id="uploadFileModal" tabindex="-1" aria-labelledby="uploadFileModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="uploadFileModalLabel">Upload File</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form method="post" action="{% url 'home:upload_file' folder_id=folder.id %}"
                    enctype="multipart/form-data">
                    {% csrf_token %}
                    <input type="file" name="file" class="form-control">
                    <button type="submit" class="btn btn-primary mt-3"><i class="fas fa-upload"></i> Upload
                        File</button>
                </form>
            </div>
        </div>
    </div>
</div>

<!-- Share Folder Modal -->
<div class="modal fade" id="shareFolderModal" tabindex="-1" aria-labelledby="shareFolderModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="shareFolderModalLabel">Share Folder</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form method="post" action="{% url 'home:share_personal_folder' %}">
                    {% csrf_token %}
                    <input type="hidden" id="folder-id" name="folder_id">
                    <div class="form-group">
                        <label for="username">Enter username to share folder:</label>
                        <input type="text" id="username" name="username" class="form-control" placeholder="Username"
                            required>
                    </div>
                    <button type="submit" class="btn btn-primary mt-3"><i class="fas fa-share-alt"></i> Share
                        Folder</button>
                </form>
            </div>
        </div>
    </div>
</div>


<script>
    const shareFolderModal = document.getElementById('shareFolderModal');
    shareFolderModal.addEventListener('show.bs.modal', function (event) {
        const button = event.relatedTarget; // Button that triggered the modal
        const folderId = button.getAttribute('data-folder-id'); // Extract folder ID from data-* attribute
        const folderInput = shareFolderModal.querySelector('#folder-id'); // Hidden input in the modal form
        folderInput.value = folderId; // Set the folder ID in the form
    });
</script>



<script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/js/bootstrap.bundle.min.js"></script>
<script>
    function goBack() {
        window.history.back();
    }
</script>

{% endblock %}